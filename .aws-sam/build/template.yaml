AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: 'Sample SAM Template for slite-backend

  '
Parameters:
  DatabaseHost:
    Type: String
    Default: localhost
    Description: Database host
  DatabasePort:
    Type: String
    Default: '5432'
    Description: Database port
  DatabaseName:
    Type: String
    Default: slitedb
    Description: Database name
  DatabaseUsername:
    Type: String
    Default: postgres
    Description: Database username
  DatabasePassword:
    Type: String
    NoEcho: true
    Default: password
    Description: Database password
Globals:
  Function:
    Timeout: 10
    MemorySize: 512
    Tracing: Active
    LoggingConfig:
      LogFormat: JSON
  Api:
    TracingEnabled: true
Resources:
  SliteBackendFunction:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: SliteBackendFunction
      Handler: SliteBackend::SliteBackend.Function::FunctionHandler
      Runtime: dotnet8
      Architectures:
      - x86_64
      MemorySize: 512
      Environment:
        Variables:
          DB_HOST:
            Ref: DatabaseHost
          DB_PORT:
            Ref: DatabasePort
          DB_NAME:
            Ref: DatabaseName
          DB_USERNAME:
            Ref: DatabaseUsername
          DB_PASSWORD:
            Ref: DatabasePassword
      Events:
        Hello:
          Type: Api
          Properties:
            Path: /hello
            Method: get
        Users:
          Type: Api
          Properties:
            Path: /users
            Method: get
        CreateUser:
          Type: Api
          Properties:
            Path: /users
            Method: post
        Companies:
          Type: Api
          Properties:
            Path: /companies
            Method: get
        CreateCompany:
          Type: Api
          Properties:
            Path: /companies
            Method: post
        Services:
          Type: Api
          Properties:
            Path: /services
            Method: get
        CreateService:
          Type: Api
          Properties:
            Path: /services
            Method: post
        CompanyServices:
          Type: Api
          Properties:
            Path: /companies/{companyId}/services
            Method: get
    Metadata:
      SamResourceId: SliteBackendFunction
Outputs:
  SliteBackendApi:
    Description: API Gateway endpoint URL for Prod stage for SliteBackend function
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/hello/
  SliteBackendFunction:
    Description: SliteBackend Lambda Function ARN
    Value:
      Fn::GetAtt:
      - SliteBackendFunction
      - Arn
  SliteBackendFunctionIamRole:
    Description: Implicit IAM Role created for SliteBackend function
    Value:
      Fn::GetAtt:
      - SliteBackendFunctionRole
      - Arn
